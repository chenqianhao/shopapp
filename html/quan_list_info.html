<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>优惠券</title>
    <link rel="stylesheet" href="../css/shuigou.css">
    <script src="../script/TouchSlide.1.0.js"></script>
    <style>

        .hd ul li { width: 33.3333%; float: left; text-align: center; }
        .hd ul { padding: 1rem 0; display: block; overflow: hidden; border-bottom: 1px solid #ededef; color: #38373c; }
        .hd ul li.on span { border-bottom: 2px solid #f34d4d; padding-bottom: 0.78rem; color: #f34d4d; }
        .bd ul { margin-top: 1rem; }
        .bd ul li {margin-bottom: 0.8rem;}
        .hd ul li a{ color:#38373C}
        .bdcotent{display: block;overflow: hidden; }
        .bdall { border: 1px solid #ccc; width: 94%; margin: auto; display: block; overflow: hidden; padding-bottom: 0.5rem;}
        .bdlipingpu { background: url("../img/youhuiquan.jpg") repeat-x; width: 100%; height: 20px; display: block;background-size: 12px; }
        .bdcotentleft, .bdcotentright { float: left; width: 50%; }
        .bdcotentleft span { font-size: 8rem; color: #fa9899; margin-left: 2rem; }
        .bdcotentleft i { font-size: 4rem; color: #fa9899; padding-right: 1rem; }
        .bdcotentrightdiv { width:50%;float: right; margin-top:2rem;margin-right: 2rem;  position:relative;}
        .bdcotentrightdiv font{position: absolute; right: -14px; top: 20%; font-size: 3.3rem; color: #d1d1d1; font-weight: bold;}
        .bdcotentrightdiv span{ display:block; text-align:center;width: 80%;color: #333;}
        .bdcotentrightdiv span:first-child{ padding-bottom:0.7rem; border-bottom:2px solid #f1f1f1;}
        .bdcotentrightdiv span:nth-child(2){padding-top:0.5rem;}
        .bddian{background: url("../img/dian.jpg") repeat-x; width: 92%; height: 11px; display: block; background-size: 9px; margin: auto;}
        .bddq{ display: block; text-align: right; color: #7b7b7b; padding-right: 1rem; padding-bottom: 0.5rem;}
    </style>


</head>
<body style="background-color: #fff;">
    


<!-- 
   <header class="gsheader" id="aui-header">
    <div class="gsheaderdivleft">
        <a tapmode onclick="api.closeWin();" class="">
              <font>&#xe619;</font>
        </a>
    </div>
    <h1>
        <a href="#title-link" class="">
              优惠券
        </a>
    </h1>

                  <div class="gsheaderdivright" tapmpde onclick="kefushow();">
          <a >
                <i><font>&#xe635;</font></i>
          </a>
      </div>
</header>
 
 -->




    <script type="text/x-dot-template" id="quan1-template">

        {{ for(var i=0,len=it.length;i<len;i++) { }}

                <li  tapmode onclick="openbounsinfo({{=it[i]['bonus_type_id']}},{{=it[i]['bonus_id']}})">
                    <div class="bdall">
                        <span class="bdlipingpu"></span>
                        <div class="bdcotent">
                            <div class="bdcotentleft">
                                <span><i>￥</i>{{=parseInt(it[i]['type_money'])}}</span>
                            </div>
                            <div class="bdcotentright">
                            <div class="bdcotentrightdiv">
                            <span>使用范围</span>
                            <span>满{{=parseInt(it[i]['min_goods_amount'])}}可用</span>
                            <font>&#xe667;</font>
                            </div>
                            </div>
                        </div>
                        <span class="bddian"></span>
                        <strong  class="bddq">{{=getDate(it[i]['use_end_date'])}}到期</strong>
                    </div>
                </li>

        {{ } }}

    </script> 


    <script type="text/x-dot-template" id="quan2-template">

        {{ for(var i=0,len=it.length;i<len;i++) { }}

                <li  tapmode onclick="openbounsinfo({{=it[i]['bonus_type_id']}},{{=it[i]['bonus_id']}})">
                    <div class="bdall">
                        <span class="bdlipingpu"></span>
                        <div class="bdcotent">
                            <div class="bdcotentleft">
                                <span><i>￥</i>{{=parseInt(it[i]['type_money'])}}</span>
                            </div>
                            <div class="bdcotentright">
                            <div class="bdcotentrightdiv">
                            <span>使用范围</span>
                            <span>满{{=parseInt(it[i]['min_goods_amount'])}}可用</span>
                            <font>&#xe667;</font>
                            </div>
                            </div>
                        </div>
                        <span class="bddian"></span>
                        <strong  class="bddq">{{=getDate(it[i]['use_end_date'])}}到期</strong>
                    </div>
                </li>

        {{ } }}

    </script> 




    <script type="text/x-dot-template" id="quan3-template">

        {{ for(var i=0,len=it.length;i<len;i++) { }}

                <li  tapmode onclick="openbounsinfo({{=it[i]['bonus_type_id']}},{{=it[i]['bonus_id']}})">
                    <div class="bdall">
                        <span class="bdlipingpu"></span>
                        <div class="bdcotent">
                            <div class="bdcotentleft">
                                <span><i>￥</i>{{=parseInt(it[i]['type_money'])}}</span>
                            </div>
                            <div class="bdcotentright">
                            <div class="bdcotentrightdiv">
                            <span>使用范围</span>
                            <span>满{{=parseInt(it[i]['min_goods_amount'])}}可用</span>
                            <font>&#xe667;</font>
                            </div>
                            </div>
                        </div>
                        <span class="bddian"></span>
                        <strong  class="bddq">{{=getDate(it[i]['use_end_date'])}}到期</strong>
                    </div>
                </li>

        {{ } }}

    </script> 


    <div id="leftTabBox" class="tabBox">
        <div class="hd">
            <ul>
                <li><a href="javascript:void(0)"><span id="quan1_num">未使用(0)</span></a></li>
                <li><a href="javascript:void(0)"><span id="quan2_num">已过期(0)</span></a></li>
                <li><a href="javascript:void(0)"><span id="quan3_num">已使用(0)</span></a></li>
            </ul>
        </div>
        <div class="bd">
            <ul id="quan1">
<!--                 <li>
                    <div class="bdall">
                        <span class="bdlipingpu"></span>
                        <div class="bdcotent">
                            <div class="bdcotentleft">
                                <span><i>￥</i>5</span>
                            </div>
                            <div class="bdcotentright">
                            <div class="bdcotentrightdiv">
                            <span>全品类</span>
                            <span>满58可用</span>
                            <font>&#xe667;</font>
                            </div>
                            </div>
                        </div>
                        <span class="bddian"></span>
                        <strong  class="bddq">2016-06-30到期</strong>
                    </div>
                </li> -->
            </ul>
            <ul id="quan2">
<!--                 <li>
                    <div class="bdall">
                        <span class="bdlipingpu"></span>
                        <div class="bdcotent">
                            <div class="bdcotentleft">
                                <span><i>￥</i>5</span>
                            </div>
                            <div class="bdcotentright">
                            <div class="bdcotentrightdiv">
                            <span>全品类</span>
                            <span>满58可用</span>
                            <font>&#xe667;</font>
                            </div>
                            </div>
                        </div>
                        <span class="bddian"></span>
                        <strong  class="bddq">2016-06-30到期</strong>
                    </div>
                </li> -->
            </ul>
            <ul class="quan3">
<!--                               <li>
                    <div class="bdall">
                        <span class="bdlipingpu"></span>
                        <div class="bdcotent">
                            <div class="bdcotentleft">
                                <span><i>￥</i>5</span>
                            </div>
                            <div class="bdcotentright">
                            <div class="bdcotentrightdiv">
                            <span>全品类</span>
                            <span>满58可用</span>
                            <font>&#xe667;</font>
                            </div>
                            </div>
                        </div>
                        <span class="bddian"></span>
                        <strong  class="bddq">2016-06-30到期</strong>
                    </div>
                </li> -->
            </ul>
        </div>
    </div>


</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/common.js"></script>
<script type="text/javascript" src="../script/doT.min.js"></script>
<script type="text/javascript">
    used_id=1;
    apiready = function(){
        api.parseTapmode();
        
        // var header = $api.byId('aui-header');
        // fixStatusBar(header);
        var userid_gs=$api.getStorage('userid_gs');
        if(!userid_gs){
            showusercenter('quan_list');
            return false;
        }

        aaaaaa(0);
        get_user_quan_list(userid_gs);
    };



    function aaaaaa(index){
        //alert(index);
        TouchSlide({ slideCell: "#leftTabBox", effect: "leftLoop",defaultIndex:index});
    }

    function get_user_quan_list(user_id){
        api.ajax({
            url: serverUrl+'/user.php?act=get_user_quan_list',
            method: 'post',
            timeout: 30,
            dataType: 'json',
            returnAll:false,
            data:{
                values: {supplier_id:SUPPLIER_ID,user_id:user_id,used_id:used_id}
            }            
        },function(ret,err){
            //api.alert({msg:JSON.stringify(ret)});
            if (ret) {
                if(ret.code==1856){
                    if(ret.quan1==''){
                        document.getElementById('quan1').innerHTML="目前还没有相关的优惠券！";
                    }else{
                        var template = document.getElementById('quan1-template').innerHTML;
                        document.getElementById('quan1').innerHTML=doT.template(template)(ret.quan1);
                        document.getElementById('quan1_num').innerHTML="未使用("+ret.quan1.length+")";
                    }

                    if(ret.quan2==''){
                        document.getElementById('quan2').innerHTML="目前还没有相关的优惠券！";
                    }else{
                        var template = document.getElementById('quan2-template').innerHTML;
                        document.getElementById('quan2').innerHTML=doT.template(template)(ret.quan2);
                        document.getElementById('quan2_num').innerHTML="已过期("+ret.quan2.length+")";
                    }


                    if(ret.quan3==''){
                        document.getElementsByClassName('quan3')[0].innerHTML="目前还没有相关的优惠券！";
                        document.getElementsByClassName('quan3')[1].innerHTML="目前还没有相关的优惠券！";
                    }else{
                        //api.alert({msg:JSON.stringify(ret.quan3)});
                        var template = document.getElementById('quan3-template').innerHTML;
                        document.getElementsByClassName('quan3')[0].innerHTML=doT.template(template)(ret.quan3);
                        document.getElementsByClassName('quan3')[1].innerHTML=doT.template(template)(ret.quan3);
                        document.getElementById('quan3_num').innerHTML="已使用("+ret.quan3.length+")";
                    }
                }else{
                    api.toast({
                        msg: ret.msg,
                        duration: 3000,
                        location: 'bottom'
                    });                 
                }
            } else {
                api.alert({
                    msg:('错误码：'+err.code+'；错误信息：'+err.msg+'网络状态码：'+err.statusCode)
                });
            };
        });
    }


    function openbounsinfo(id,bonus_id){

        //alert(bonus_id);
        api.openWin({
            name: 'bonus_info',
            url: 'bonus_info.html',
            reload:true,
            bounces: false,
            pageParam: {bonus_type_id : id}
        });
    }
</script>
</html>